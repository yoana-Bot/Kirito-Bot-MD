const handler = async (m, { isOwner, isAdmin, conn, text, participants, args, command, usedPrefix }) => {
  if (usedPrefix == 'a' || usedPrefix == 'A') return;

  const customEmoji = global.db.data.chats[m.chat]?.customEmoji || 'ðŸ”¥';
  m.react(customEmoji);

  if (!(isAdmin || isOwner)) {
    global.dfail('admin', m, conn);
    throw false;
  }

  const countryFlags = {
    "1": "ðŸ‡ºðŸ‡¸", "7": "ðŸ‡·ðŸ‡º", "20": "ðŸ‡ªðŸ‡¬", "27": "ðŸ‡¿ðŸ‡¦", "30": "ðŸ‡¬ðŸ‡·", "31": "ðŸ‡³ðŸ‡±",
    "32": "ðŸ‡§ðŸ‡ª", "33": "ðŸ‡«ðŸ‡·", "34": "ðŸ‡ªðŸ‡¸", "36": "ðŸ‡­ðŸ‡º", "39": "ðŸ‡®ðŸ‡¹", "40": "ðŸ‡·ðŸ‡´",
    "41": "ðŸ‡¨ðŸ‡­", "43": "ðŸ‡¦ðŸ‡¹", "44": "ðŸ‡¬ðŸ‡§", "45": "ðŸ‡©ðŸ‡°", "46": "ðŸ‡¸ðŸ‡ª", "47": "ðŸ‡³ðŸ‡´",
    "48": "ðŸ‡µðŸ‡±", "49": "ðŸ‡©ðŸ‡ª", "51": "ðŸ‡µðŸ‡ª", "52": "ðŸ‡²ðŸ‡½", "53": "ðŸ‡¨ðŸ‡º", "54": "ðŸ‡¦ðŸ‡·",
    "55": "ðŸ‡§ðŸ‡·", "56": "ðŸ‡¨ðŸ‡±", "57": "ðŸ‡¨ðŸ‡´", "58": "ðŸ‡»ðŸ‡ª", "60": "ðŸ‡²ðŸ‡¾", "61": "ðŸ‡¦ðŸ‡º",
    "62": "ðŸ‡®ðŸ‡©", "63": "ðŸ‡µðŸ‡­", "64": "ðŸ‡³ðŸ‡¿", "65": "ðŸ‡¸ðŸ‡¬", "66": "ðŸ‡¹ðŸ‡­", "81": "ðŸ‡¯ðŸ‡µ",
    "82": "ðŸ‡°ðŸ‡·", "84": "ðŸ‡»ðŸ‡³", "86": "ðŸ‡¨ðŸ‡³", "90": "ðŸ‡¹ðŸ‡·", "91": "ðŸ‡®ðŸ‡³", "92": "ðŸ‡µðŸ‡°",
    "93": "ðŸ‡¦ðŸ‡«", "94": "ðŸ‡±ðŸ‡°", "95": "ðŸ‡²ðŸ‡²", "98": "ðŸ‡®ðŸ‡·", "211": "ðŸ‡¸ðŸ‡¸", "212": "ðŸ‡²ðŸ‡¦",
    "213": "ðŸ‡©ðŸ‡¿", "216": "ðŸ‡¹ðŸ‡³", "218": "ðŸ‡±ðŸ‡¾", "220": "ðŸ‡¬ðŸ‡²", "221": "ðŸ‡¸ðŸ‡³", "222": "ðŸ‡²ðŸ‡·",
    "223": "ðŸ‡²ðŸ‡±", "224": "ðŸ‡¬ðŸ‡³", "225": "ðŸ‡¨ðŸ‡®", "226": "ðŸ‡§ðŸ‡«", "227": "ðŸ‡³ðŸ‡ª", "228": "ðŸ‡¹ðŸ‡¬",
    "229": "ðŸ‡§ðŸ‡¯", "230": "ðŸ‡²ðŸ‡º", "231": "ðŸ‡±ðŸ‡·", "232": "ðŸ‡¸ðŸ‡±", "233": "ðŸ‡¬ðŸ‡­", "234": "ðŸ‡³ðŸ‡¬",
    "235": "ðŸ‡¹ðŸ‡©", "236": "ðŸ‡¨ðŸ‡«", "237": "ðŸ‡¨ðŸ‡²", "238": "ðŸ‡¨ðŸ‡»", "239": "ðŸ‡¸ðŸ‡¹", "240": "ðŸ‡¬ðŸ‡¶",
    "241": "ðŸ‡¬ðŸ‡¦", "242": "ðŸ‡¨ðŸ‡¬", "243": "ðŸ‡¨ðŸ‡©", "244": "ðŸ‡¦ðŸ‡´", "245": "ðŸ‡¬ðŸ‡¼", "246": "ðŸ‡®ðŸ‡´",
    "248": "ðŸ‡¸ðŸ‡¨", "249": "ðŸ‡¸ðŸ‡©", "250": "ðŸ‡·ðŸ‡¼", "251": "ðŸ‡ªðŸ‡¹", "252": "ðŸ‡¸ðŸ‡´", "253": "ðŸ‡©ðŸ‡¯",
    "254": "ðŸ‡°ðŸ‡ª", "255": "ðŸ‡¹ðŸ‡¿", "256": "ðŸ‡ºðŸ‡¬", "257": "ðŸ‡§ðŸ‡®", "258": "ðŸ‡²ðŸ‡¿", "260": "ðŸ‡¿ðŸ‡²",
    "261": "ðŸ‡²ðŸ‡¬", "262": "ðŸ‡·ðŸ‡ª", "263": "ðŸ‡¿ðŸ‡¼", "264": "ðŸ‡³ðŸ‡¦", "265": "ðŸ‡²ðŸ‡¼", "266": "ðŸ‡±ðŸ‡¸",
    "267": "ðŸ‡§ðŸ‡¼", "268": "ðŸ‡¸ðŸ‡¿", "269": "ðŸ‡°ðŸ‡²", "290": "ðŸ‡¸ðŸ‡­", "291": "ðŸ‡ªðŸ‡·", "297": "ðŸ‡¦ðŸ‡¼",
    "298": "ðŸ‡«ðŸ‡´", "299": "ðŸ‡¬ðŸ‡±", "350": "ðŸ‡¬ðŸ‡®", "351": "ðŸ‡µðŸ‡¹", "352": "ðŸ‡±ðŸ‡º", "353": "ðŸ‡®ðŸ‡ª",
    "354": "ðŸ‡®ðŸ‡¸", "355": "ðŸ‡¦ðŸ‡±", "356": "ðŸ‡²ðŸ‡¹", "357": "ðŸ‡¨ðŸ‡¾", "358": "ðŸ‡«ðŸ‡®", "359": "ðŸ‡§ðŸ‡¬",
    "370": "ðŸ‡±ðŸ‡¹", "371": "ðŸ‡±ðŸ‡»", "372": "ðŸ‡ªðŸ‡ª", "373": "ðŸ‡²ðŸ‡©", "374": "ðŸ‡¦ðŸ‡²", "375": "ðŸ‡§ðŸ‡¾",
    "376": "ðŸ‡¦ðŸ‡©", "377": "ðŸ‡²ðŸ‡¨", "378": "ðŸ‡¸ðŸ‡²", "379": "ðŸ‡»ðŸ‡¦", "380": "ðŸ‡ºðŸ‡¦", "381": "ðŸ‡·ðŸ‡¸",
    "382": "ðŸ‡²ðŸ‡ª", "383": "ðŸ‡½ðŸ‡°", "385": "ðŸ‡­ðŸ‡·", "386": "ðŸ‡¸ðŸ‡®", "387": "ðŸ‡§ðŸ‡¦", "389": "ðŸ‡²ðŸ‡°",
    "420": "ðŸ‡¨ðŸ‡¿", "421": "ðŸ‡¸ðŸ‡°", "423": "ðŸ‡±ðŸ‡®", "500": "ðŸ‡«ðŸ‡°", "501": "ðŸ‡§ðŸ‡¿", "502": "ðŸ‡¬ðŸ‡¹",
    "503": "ðŸ‡¸ðŸ‡»", "504": "ðŸ‡­ðŸ‡³", "505": "ðŸ‡³ðŸ‡®", "506": "ðŸ‡¨ðŸ‡·", "507": "ðŸ‡µðŸ‡¦", "508": "ðŸ‡µðŸ‡²",
    "509": "ðŸ‡­ðŸ‡¹", "590": "ðŸ‡¬ðŸ‡µ", "591": "ðŸ‡§ðŸ‡´", "592": "ðŸ‡¬ðŸ‡¾", "593": "ðŸ‡ªðŸ‡¨", "594": "ðŸ‡¬ðŸ‡«",
    "595": "ðŸ‡µðŸ‡¾", "596": "ðŸ‡²ðŸ‡¶", "597": "ðŸ‡¸ðŸ‡·", "598": "ðŸ‡ºðŸ‡¾", "599": "ðŸ‡¨ðŸ‡¼", "670": "ðŸ‡¹ðŸ‡±",
    "672": "ðŸ‡³ðŸ‡«", "673": "ðŸ‡§ðŸ‡³", "674": "ðŸ‡³ðŸ‡·", "675": "ðŸ‡µðŸ‡¬", "676": "ðŸ‡¹ðŸ‡´", "677": "ðŸ‡¸ðŸ‡§",
    "678": "ðŸ‡»ðŸ‡º", "679": "ðŸ‡«ðŸ‡¯", "680": "ðŸ‡µðŸ‡¼", "681": "ðŸ‡¼ðŸ‡«", "682": "ðŸ‡¨ðŸ‡°", "683": "ðŸ‡³ðŸ‡º",
    "685": "ðŸ‡¼ðŸ‡¸", "686": "ðŸ‡°ðŸ‡®", "687": "ðŸ‡³ðŸ‡¨", "688": "ðŸ‡¹ðŸ‡»", "689": "ðŸ‡µðŸ‡«", "690": "ðŸ‡¹ðŸ‡°",
    "691": "ðŸ‡«ðŸ‡²", "692": "ðŸ‡²ðŸ‡­", "850": "ðŸ‡°ðŸ‡µ", "852": "ðŸ‡­ðŸ‡°", "853": "ðŸ‡²ðŸ‡´", "855": "ðŸ‡°ðŸ‡­",
    "856": "ðŸ‡±ðŸ‡¦", "880": "ðŸ‡§ðŸ‡©", "886": "ðŸ‡¹ðŸ‡¼", "960": "ðŸ‡²ðŸ‡»", "961": "ðŸ‡±ðŸ‡§", "962": "ðŸ‡¯ðŸ‡´",
    "963": "ðŸ‡¸ðŸ‡¾", "964": "ðŸ‡®ðŸ‡¶", "965": "ðŸ‡°ðŸ‡¼", "966": "ðŸ‡¸ðŸ‡¦", "967": "ðŸ‡¾ðŸ‡ª", "968": "ðŸ‡´ðŸ‡²",
    "970": "ðŸ‡µðŸ‡¸", "971": "ðŸ‡¦ðŸ‡ª", "972": "ðŸ‡®ðŸ‡±", "973": "ðŸ‡§ðŸ‡­", "974": "ðŸ‡¶ðŸ‡¦", "975": "ðŸ‡§ðŸ‡¹",
    "976": "ðŸ‡²ðŸ‡³", "977": "ðŸ‡³ðŸ‡µ", "992": "ðŸ‡¹ðŸ‡¯", "993": "ðŸ‡¹ðŸ‡²", "994": "ðŸ‡¦ðŸ‡¿", "995": "ðŸ‡¬ðŸ‡ª",
    "996": "ðŸ‡°ðŸ‡¬", "998": "ðŸ‡ºðŸ‡¿"
  };

  const pesan = args.join` `;
  const oi = `*Â» INFO :* ${pesan}`;
  let teks = `*!  MENCION GENERAL  !*\n  *PARA ${participants.length} MIEMBROS* âš¡\n\n ${oi}\n\nâ”â•â”…â”…â•â”…â•=ÍŸÍŸÍž${botname} â•â”…â•â”…â”…â•â•â•â˜¾\n`;

  for (const mem of participants) {
    const number = mem.id.split('@')[0];
    const prefix = getPrefix(number); 
    const flag = countryFlags[prefix] || "ðŸ³ï¸â€ðŸŒˆ"; 
    teks += `â”ƒâ¤ÍŸÍžÍŸÍž${flag} @${number}\n`;
  }

  teks += `â”—â”…â•â•â”…â•â”… *${vs}* â•â”…â•â”…â”…â•â”…â˜¾`;

  conn.sendMessage(m.chat, { text: teks, mentions: participants.map((a) => a.id) });
};

function getPrefix(number) {
  for (let i = 4; i >= 1; i--) {
    const sub = number.slice(0, i);
    if (sub in {
      "1": 1, "7": 1, "20": 1, "27": 1, "30": 1, "31": 1,
      "32": 1, "33": 1, "34": 1, "36": 1, "39": 1, "40": 1,
      "41": 1, "43": 1, "44": 1, "45": 1, "46": 1, "47": 1,
      "48": 1, "49": 1, "51": 1, "52": 1, "53": 1, "54": 1,
      "55": 1, "56": 1, "57": 1, "58": 1, "60": 1, "61": 1,
      "62": 1, "63": 1, "64": 1, "65": 1, "66": 1, "81": 1,
      "82": 1, "84": 1, "86": 1, "90": 1, "91": 1, "92": 1,
      "93": 1, "94": 1, "95": 1, "98": 1, "211": 1, "212": 1,
      "213": 1, "216": 1, "218": 1, "220": 1, "221": 1, "222": 1,
      "223": 1, "224": 1, "225": 1, "226": 1, "227": 1, "228": 1,
      "229": 1, "230": 1, "231": 1, "232": 1, "233": 1, "234": 1,
      "235": 1, "236": 1, "237": 1, "238": 1, "239": 1, "240": 1,
      "241": 1, "242": 1, "243": 1, "244": 1, "245": 1, "246": 1,
      "248": 1, "249": 1, "250": 1, "251": 1, "252": 1, "253": 1,
      "254": 1, "255": 1, "256": 1, "257": 1, "258": 1, "260": 1,
      "261": 1, "262": 1, "263": 1, "264": 1, "265": 1, "266": 1,
      "267": 1, "268": 1, "269": 1, "290": 1, "291": 1, "297": 1,
      "298": 1, "299": 1, "350": 1, "351": 1, "352": 1, "353": 1,
      "354": 1, "355": 1, "356": 1, "357": 1, "358": 1, "359": 1,
      "370": 1, "371": 1, "372": 1, "373": 1, "374": 1, "375": 1,
      "376": 1, "377": 1, "378": 1, "379": 1, "380": 1, "381": 1,
      "382": 1, "383": 1, "385": 1, "386": 1, "387": 1, "389": 1,
      "420": 1, "421": 1, "423": 1, "500": 1, "501": 1, "502": 1,
      "503": 1, "504": 1, "505": 1, "506": 1, "507": 1, "508": 1,
      "509": 1, "590": 1, "591": 1, "592": 1, "593": 1, "594": 1,
      "595": 1, "596": 1, "597": 1, "598": 1, "599": 1, "670": 1,
      "672": 1, "673": 1, "674": 1, "675": 1, "676": 1, "677": 1,
      "678": 1, "679": 1, "680": 1, "681": 1, "682": 1, "683": 1,
      "685": 1, "686": 1, "687": 1, "688": 1, "689": 1, "690": 1,
      "691": 1, "692": 1, "850": 1, "852": 1, "853": 1, "855": 1,
      "856": 1, "880": 1, "886": 1, "960": 1, "961": 1, "962": 1,
      "963": 1, "964": 1, "965": 1, "966": 1, "967": 1, "968": 1,
      "970": 1, "971": 1, "972": 1, "973": 1, "974": 1, "975": 1,
      "976": 1, "977": 1, "992": 1, "993": 1, "994": 1, "995": 1,
      "996": 1, "998": 1
    }) {
      return sub;
    }
  }
  return "";
}

handler.help = ['todos *<mensaje opcional>*'];
handler.tags = ['group'];
handler.command = ['todos', 'invocar', 'tagall'];